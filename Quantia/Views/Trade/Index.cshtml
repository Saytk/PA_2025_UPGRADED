@using Quantia.Models
@model IEnumerable<TradeModel>
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewBag.Section = "Trades";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h1>My Trades</h1>

<table style="width:100%; border-collapse: collapse; margin-top:20px;">
    <thead>
        <tr style="background:#f3f4f6;">
            <th style="padding:10px; text-align:left;">Coin</th>
            <th style="padding:10px; text-align:right;">Buy&nbsp;Price</th>
            <th style="padding:10px; text-align:right;">Quantity</th>
            <th style="padding:10px; text-align:right;">Buy&nbsp;Date</th>
            <th style="padding:10px; text-align:right;">Sell&nbsp;Price</th>
            <th style="padding:10px; text-align:right;">Sell&nbsp;Date</th>
            <th style="padding:10px; text-align:right;">PnL&nbsp;($)</th>
            <th style="padding:10px; text-align:center;">Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var t in Model)
        {
            var pnl = t.PnL ?? 0m;
            var pnlColor = pnl >= 0 ? "green" : "red";
            <tr>
                <td style="padding:10px;">@t.CryptoSymbol</td>
                <td style="padding:10px; text-align:right;">@t.BuyPrice.ToString("F2")</td>
                <td style="padding:10px; text-align:right;">@t.Quantity.ToString("F6")</td>
                <td style="padding:10px; text-align:right;">@t.BuyDate.ToString("yyyy-MM-dd HH:mm")</td>
                <td style="padding:10px; text-align:right;">@(t.SellPrice.HasValue ? t.SellPrice.Value.ToString("F2") : "-")</td>
                <td style="padding:10px; text-align:right;">@(t.SellDate.HasValue ? t.SellDate.Value.ToString("yyyy-MM-dd HH:mm") : "-")</td>
                <td style="padding:10px; text-align:right; color:@pnlColor;">
                    @(t.PnL.HasValue ? pnl.ToString("F2") : "-")
                </td>
                <td style="padding:10px; text-align:center;">
                    @if (t.Status == "Open")
                    {
                        <a href="@Url.Action("Edit", "Trade", new { id = t.Id })">Close</a>
                    }
                    else
                    {
                        <span style="color:#888;">Closed</span>
                    }

                    <!-- bouton Delete identique -->
                    <form asp-action="Delete" asp-controller="Trade"
                          asp-route-id="@t.Id" method="post" style="display:inline;">
                        @Html.AntiForgeryToken()
                        <button type="submit"
                                style="background:none;border:none;color:red;cursor:pointer;">
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<div style="margin-top:30px;">
    <a href="@Url.Action("Create", "Trade")" style="padding:10px 20px; background:#2563eb; color:#fff; border-radius:4px; text-decoration:none;">New Trade</a>
</div>

